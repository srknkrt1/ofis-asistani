<form action="/pdf/merge/submit" method="post" enctype="multipart/form-data" onsubmit="return prepareOrder();">
  <input type="file" name="pdfs" id="pdfs" multiple required class="form-control mb-3">
  <button class="btn btn-primary mb-3" type="button" onclick="previewFiles()">ğŸ“‘ DosyalarÄ± Ã–nizle</button>

  <div id="file-list" class="sortable-container mb-3"></div>
  <div id="order-inputs"></div>

  <button class="btn btn-success" type="submit">ğŸ“ PDF'leri BirleÅŸtir</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  let fileList = [];

  function previewFiles() {
    const input = document.getElementById('pdfs');
    fileList = Array.from(input.files);

    const container = document.getElementById('file-list');
    container.innerHTML = '';

    fileList.forEach((file, index) => {
      const div = document.createElement('div');
      div.className = "border p-2 bg-white";
      div.setAttribute('data-index', index);
      div.textContent = file.name;
      container.appendChild(div);
    });

    Sortable.create(container, { animation: 150 });
  }

  function prepareOrder() {
    const orderedIndices = Array.from(document.querySelectorAll('#file-list div')).map(div => div.dataset.index);
    const orderContainer = document.getElementById('order-inputs');
    orderContainer.innerHTML = '';

    orderedIndices.forEach(i => {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'order[]';
      input.value = i;
      orderContainer.appendChild(input);
    });

    return true;
  }
</script>

<style>
  .sortable-container {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .sortable-container div {
    cursor: move;
    padding: 10px;
    background: #f9f9f9;
    border: 1px solid #ccc;
    min-width: 150px;
    text-align: center;
  }
</style>
